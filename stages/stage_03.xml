<?xml version="1.0"?>

<build name="minux" type="live" subject="base" stage="03" constructor="yes" in-chroot="yes" arch="x86_64" version="0.0.2" hostname="$PROJECT_NAME-$PROJECT_ARCH" timezone="Asia/Tehran">

	<phase seq="1">
	
		<entry name="linux-4.4.6" type="package/src" seq="1" cdto="yes" download="no" extract="yes">
		    <filename>linux-4.4.6.tar.xz</filename>
		    <version>4.4.6</version>
		    <checksum type="md5">efc822dad2149e40cc908718a4fea1d3</checksum>
            <action when="after" seq="1">
                <line verbos="yes">make mrproper</line>
                
                <line verbos="yes">make INSTALL_HDR_PATH=dest headers_install</line>
                <line verbos="yes">find dest/include \( -name .install -o -name ..install.cmd \) -delete</line>
                <line verbos="yes">cp -rv dest/include/* /usr/include</line>
            </action>
		</entry>
		
		<entry name="man-pages-4.07" type="package/src" seq="2" cdto="yes" download="no" extract="yes">
		    <filename>man-pages-4.07.tar.xz</filename>
		    <version>4.07</version>
		    <checksum type="md5">6d6c59b83431852ba44930785def30d4</checksum>
            <action when="after" seq="1">
                <line verbos="yes">make install</line>
            </action>
		</entry>
		
		<entry name="glibc-2.24" type="package/src" seq="3" cdto="yes" download="no" extract="yes">
		    <filename>glibc-2.24.tar.xz</filename>
		    <version>4.07</version>
		    <checksum type="md5">97dc5517f92016f3d70d83e3162ad318</checksum>
            <action when="after" seq="1">
                <line verbos="yes">patch -Np1 -i $PROJECT__PKG/glibc-2.24-fhs-1.patch</line>
                <line>mkdir -v build</line>
                <line>cd build</line>
                <line verbos="yes">
                	../configure                 \
                		--prefix=/usr            \
						--enable-kernel=2.6.32   \
						--enable-obsolete-rpc
				</line>
				<line verbos="yes">make</line>
				<line verbos="yes">touch /etc/ld.so.conf</line>
				<line verbos="yes">make install</line>
				<line verbos="yes">cp -v ../nscd/nscd.conf /etc/nscd.conf</line>
				<line verbos="yes">mkdir -pv /var/cache/nscd</line>
				<line verbos="yes">install -v -Dm644 ../nscd/nscd.tmpfiles /usr/lib/tmpfiles.d/nscd.conf</line>
				<line verbos="yes">install -v -Dm644 ../nscd/nscd.service /lib/systemd/system/nscd.service</line>
            </action>
            
            <action when="after" seq="2" comment="Instructions will install the minimum set of locales necessary">
            	<line>mkdir -pv /usr/lib/locale</line>
				<line>localedef -i cs_CZ -f UTF-8 cs_CZ.UTF-8</line>
				<line>localedef -i de_DE -f ISO-8859-1 de_DE</line>
				<line>localedef -i de_DE@euro -f ISO-8859-15 de_DE@euro</line>
				<line>localedef -i de_DE -f UTF-8 de_DE.UTF-8</line>
				<line>localedef -i en_GB -f UTF-8 en_GB.UTF-8</line>
				<line>localedef -i en_HK -f ISO-8859-1 en_HK</line>
				<line>localedef -i en_PH -f ISO-8859-1 en_PH</line>
				<line>localedef -i en_US -f ISO-8859-1 en_US</line>
				<line>localedef -i en_US -f UTF-8 en_US.UTF-8</line>
				<line>localedef -i es_MX -f ISO-8859-1 es_MX</line>
				<line>localedef -i fa_IR -f UTF-8 fa_IR</line>
				<line>localedef -i fr_FR -f ISO-8859-1 fr_FR</line>
				<line>localedef -i fr_FR@euro -f ISO-8859-15 fr_FR@euro</line>
				<line>localedef -i fr_FR -f UTF-8 fr_FR.UTF-8</line>
				<line>localedef -i it_IT -f ISO-8859-1 it_IT</line>
				<line>localedef -i it_IT -f UTF-8 it_IT.UTF-8</line>
				<line>localedef -i ja_JP -f EUC-JP ja_JP</line>
				<line>localedef -i ru_RU -f KOI8-R ru_RU.KOI8-R</line>
				<line>localedef -i ru_RU -f UTF-8 ru_RU.UTF-8</line>
				<line>localedef -i tr_TR -f UTF-8 tr_TR.UTF-8</line>
				<line>localedef -i zh_CN -f GB18030 zh_CN.GB18030</line>
				
				<line>make localedata/install-locales</line>
            </action>
            
            <action when="after" seq="3" comment="Adding nsswitch.conf">
				cat > /etc/nsswitch.conf &lt;&lt;-EOF
				# Begin /etc/nsswitch.conf
				passwd: files
				group: files
				shadow: files
				hosts: files dns
				networks: files
				protocols: files
				services: files
				ethers: files
				rpc: files
				# End /etc/nsswitch.conf
				
				EOF
            </action>
            
            <action when="after" seq="4" comment="Adding time zone data">
                <line>tar -xf $PROJECT__PKG/tzdata2016f.tar.gz</line>
                <line>ZONEINFO=/usr/share/zoneinfo</line>
                <line>mkdir -pv $ZONEINFO/{posix,right}</line>
                <line>
					for tz in etcetera southamerica northamerica europe africa antarctica \
						asia australasia backward pacificnew systemv; do
						zic -L /dev/null -d $ZONEINFO -y "sh yearistype.sh" ${tz}
						zic -L /dev/null -d $ZONEINFO/posix -y "sh yearistype.sh" ${tz}
						zic -L leapseconds -d $ZONEINFO/right -y "sh yearistype.sh" ${tz}
					done
                </line>
				<line verbos="yes">cp -v zone.tab zone1970.tab iso3166.tab $ZONEINFO</line>
				<line verbos="yes">zic -d $ZONEINFO -p America/New_York</line>
				<line>unset ZONEINFO</line>
            </action>
            
            <action when="after" seq="5" comment="Selecting timezone">
                <line verbos="yes">ln -sfv /usr/share/zoneinfo/$PROJECT__TMZ /etc/localtime</line>
            </action>
            
            <action when="after" seq="6" comment="Configuring the Dynamic Loader">
            	<line verbos="yes">
					cat > /etc/ld.so.conf &lt;&lt;-EOF
					# Begin /etc/ld.so.conf
					/usr/local/lib
					/opt/lib
				
					EOF
				</line>
				<line verbos="yes">
					cat >> /etc/ld.so.conf &lt;&lt;-EOF
					# Add an include directory
					include /etc/ld.so.conf.d/*.conf
				
					EOF
				</line>
				<line>mkdir -pv /etc/ld.so.conf.d</line>
            </action>
            
            <action when="after" seq="7" comment="Adjusting the Toolchain">
                <line>mv -v /tools/bin/{ld,ld-old}</line>
                <line>mv -v /tools/$(uname -m)-pc-linux-gnu/bin/{ld,ld-old}</line>
                <line>mv -v /tools/bin/{ld-new,ld}</line>
                <line>ln -sv /tools/bin/ld $PROJECT__TOL/$(uname -m)-pc-linux-gnu/bin/ld</line>
				<line verbos="yes">
					gcc -dumpspecs | sed -e 's@/tools@@g'				     \
						-e '/\*startfile_prefix_spec:/{n;s@.*@/usr/lib/ @}'  \
						-e '/\*cpp:/{n;s@$@ -isystem /usr/include@}' >		 \
						`dirname $(gcc --print-libgcc-file-name)`/specs
				</line>
            </action>
		</entry>
		
		<entry name="zlib-1.2.8" type="package/src" seq="4" cdto="yes" download="no" extract="yes">
		    <filename>zlib-1.2.8.tar.xz</filename>
		    <version>1.2.8</version>
		    <checksum type="md5">28f1205d8dd2001f26fec1e8c2cebe37</checksum>
            <action when="after" seq="1">
                <line verbos="yes">./configure --prefix=/usr</line>
                <line verbos="yes">make</line>
                <line verbos="yes">make install</line>
				<line verbos="yes">mv -v /usr/lib/libz.so.* /lib</line>
   				<line>cd $PROJECT__RFS</line>
				<line verbos="yes">ln -sfv /lib/$(readlink ./usr/lib/libz.so) ./usr/lib/libz.so</line>
            </action>
		</entry>
		
		<entry name="file-5.28" type="package/src" seq="5" cdto="yes" download="no" extract="yes">
		    <filename>file-5.28.tar.gz</filename>
		    <version>4.07</version>
		    <checksum type="md5">3f7771424aa855f32094b49571e19b33</checksum>
            <action when="after" seq="1">
                <line verbos="yes">./configure --prefix=/usr</line>
                <line verbos="yes">make</line>
                <line verbos="yes">make install</line>
            </action>
		</entry>
		
		<entry name="binutils-2.27" type="package/src" seq="6" cdto="yes" download="no" extract="yes">
		    <filename>binutils-2.27.tar.bz2</filename>
		    <version>2.27</version>
		    <checksum type="md5">2869c9bf3e60ee97c74ac2a6bf4e9d68</checksum>
            <action when="after" seq="1">
            	<line>mkdir -v build</line>
            	<line>cd build</line>
            	<line verbos="yes">
					../configure          \
						--prefix=/usr     \
						--enable-shared   \
						--disable-werror
            	</line>
                <line verbos="yes">make tooldir=/usr</line>
                <line verbos="yes">make tooldir=/usr install</line>
            </action>
		</entry>
		
		<entry name="gmp-6.1.1" type="package/src" seq="7" cdto="yes" download="no" extract="yes">
		    <filename>gmp-6.1.1.tar.xz</filename>
		    <version>6.1.1</version>
		    <checksum type="md5">e70e183609244a332d80529e7e155a35</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">
					./configure                             \
						--prefix=/usr                       \
						--enable-cxx                        \
						--disable-static                    \
						--docdir=/usr/share/doc/gmp-6.1.1
            	</line>
                <line verbos="yes">make</line>
                <line verbos="yes">make html</line>
                <line verbos="yes">make install</line>
                <line verbos="yes">make install-html</line>
            </action>
		</entry>
		
		<entry name="mpfr-3.1.4" type="package/src" seq="8" cdto="yes" download="no" extract="yes">
		    <filename>mpfr-3.1.4.tar.xz</filename>
		    <version>6.1.1</version>
		    <checksum type="md5">064b2c18185038e404a401b830d59be8</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">
					./configure                             \
						--prefix=/usr                       \
						--disable-static                    \
						--enable-thread-safe                \
						--docdir=/usr/share/doc/mpfr-3.1.4
            	</line>
                <line verbos="yes">make</line>
                <line verbos="yes">make html</line>
                <line verbos="yes">make install</line>
                <line verbos="yes">make install-html</line>
            </action>
		</entry>
		
		<entry name="mpc-1.0.3" type="package/src" seq="9" cdto="yes" download="no" extract="yes">
		    <filename>mpc-1.0.3.tar.gz</filename>
		    <version>1.0.3</version>
		    <checksum type="md5">d6a1d5f8ddea3abd2cc3e98f58352d26</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">
            		./configure                              \
            			--with-mpfr-lib=/usr/lib64           \
            			--with-mpfr-include=/usr/include     \
            			--enable-shared                      \
            			--disable-static                     \
            			--prefix=/usr                        \
            			--docdir=/usr/share/doc/mpc-1.0.3
            	</line>
                <line verbos="yes">make</line>
                <line verbos="yes">make html</line>
                <line verbos="yes">make install</line>
                <line verbos="yes">make install-html</line>
            </action>
		</entry>
		
		<entry name="gcc-6.2.0" type="package/src" seq="10" cdto="yes" download="no" extract="yes">
		    <filename>gcc-6.2.0.tar.bz2</filename>
		    <version>6.2.0</version>
		    <checksum type="md5">9768625159663b300ae4de2f4745fcc4</checksum>
            <action when="after" seq="1">
            	<line>mkdir -v build</line>
            	<line>cd build</line>
				<line verbos="yes">
					SED=sed                               \
					../configure                          \
						--prefix=/usr                     \
						--enable-languages=c,c++          \
						--disable-multilib                \
						--disable-bootstrap               \
						--with-system-zlib
				</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>

				<line verbos="yes">ln -sv ../usr/bin/cpp /lib</line>
				<line verbos="yes">ln -sv gcc /usr/bin/cc</line>

				<line verbos="yes">install -v -dm755 /usr/lib/bfd-plugins</line>

				<line verbos="yes">ln -sfv ../../libexec/gcc/$(gcc -dumpmachine)/6.2.0/liblto_plugin.so /usr/lib/bfd-plugins/</line>
				<line>mkdir -pv /usr/share/gdb/auto-load/usr/lib</line>
				<line verbos="yes">mv -v /usr/lib64/*gdb.py /usr/share/gdb/auto-load/usr/lib</line>
				
				<line>exit -1</line>
            </action>
		</entry>
		
		<entry name="bzip2-1.0.6" type="package/src" seq="11" cdto="yes" download="no" extract="yes">
		    <filename>bzip2-1.0.6.tar.gz</filename>
		    <version>1.0.6</version>
		    <checksum type="md5">00b516f4704d4a7cb50a1d97e6e8e15b</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">patch -Np1 -i /bzip2-1.0.6-install_docs-1.patch</line>
            	<line verbos="yes">sed -i 's@\(ln -s -f \)$(PREFIX)/bin/@\1@' Makefile</line>
				<line verbos="yes">sed -i "s@(PREFIX)/man@(PREFIX)/share/man@g" Makefile</line>
				<line verbos="yes">make -f Makefile-libbz2_so</line>
				<line verbos="yes">make clean</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make PREFIX=/usr install</line>
				<line verbos="yes">cp -v bzip2-shared /bin/bzip2</line>
				<line verbos="yes">cp -av libbz2.so* /lib</line>
				<line verbos="yes">ln -sv ../../lib/libbz2.so.1.0 /usr/lib/libbz2.so</line>
				<line verbos="yes">rm -v /usr/bin/{bunzip2,bzcat,bzip2}</line>
				<line verbos="yes">ln -sv bzip2 /bin/bunzip2</line>
				<line verbos="yes">ln -sv bzip2 /bin/bzcat</line>
            </action>
		</entry>
		
		<entry name="pkg-config-0.29.1" type="package/src" seq="12" cdto="yes" download="no" extract="yes">
		    <filename>pkg-config-0.29.1.tar.gz</filename>
		    <version>0.29.1</version>
		    <checksum type="md5">f739a28cae4e0ca291f82d1d41ef107d</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">
					./configure                                    \
						--prefix=/usr                              \
						--with-internal-glib                       \
						--disable-compile-warnings                 \
						--disable-host-tool                        \
						--docdir=/usr/share/doc/pkg-config-0.29.1
            	</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
            </action>
		</entry>
		
		<entry name="ncurses-6.0" type="package/src" seq="13" cdto="yes" download="no" extract="yes">
		    <filename>ncurses-6.0.tar.gz</filename>
		    <version>6.0</version>
		    <checksum type="md5">ee13d052e1ead260d7c28071f46eefb1</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">sed -i '/LIBTOOL_INSTALL/d' c++/Makefile.in</line>
            	<line verbos="yes">
					./configure                   \
						--prefix=/usr             \
						--mandir=/usr/share/man   \
						--with-shared             \
						--without-debug           \
						--without-normal          \
						--enable-pc-files         \
						--enable-widec
            	</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make DESTDIR=/usr install</line>
				<line verbos="yes">#mv -v /usr/lib64/libncursesw.so.6* /lib64</line>
				<line verbos="yes">ln -sfv ../../lib64/$(readlink /usr/lib64/libncursesw.so) /usr/lib64/libncursesw.so</line>
				<line verbos="yes">
					for lib in ncurses form panel menu ; do
						rm -vf                         /usr/lib/lib${lib}.so
						echo "INPUT(-l${lib}w)" >      /usr/lib/lib${lib}.so
						ln -sfv ${lib}w.pc             /usr/lib/pkgconfig/${lib}.pc
					done
				</line>
				<line verbos="yes">rm -vf /usr/lib64/libcursesw.so</line>
				<line verbos="yes">echo "INPUT(-lncursesw)" > /usr/lib64/libcursesw.so</line>
				<line verbos="yes">ln -sfv libncurses.so /usr/lib64/libcurses.so</line>
				
				<line verbos="yes">mkdir -v /usr/share/doc/ncurses-6.0</line>
				<line verbos="yes">cp -v -R doc/* /usr/share/doc/ncurses-6.0</line>
            </action>
		</entry>
		
		<entry name="attr-2.4.47" type="package/src" seq="14" cdto="yes" download="no" extract="yes">
		    <filename>attr-2.4.47.src.tar.gz</filename>
		    <version>2.4.47</version>
		    <checksum type="md5">84f58dec00b60f2dc8fd1c9709291cc7</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">sed -i -e 's|/@pkg_name@|&amp;-@pkg_version@|' include/builddefs.in</line>
				<line verbos="yes">sed -i -e "/SUBDIRS/s|man[25]||g" man/Makefile</line>
				<line verbos="yes">
					./configure --prefix=/usr --disable-static
				</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make DESTDIR=/usr install install-dev install-lib</line>
				<line verbos="yes">chmod -v 755 /usr/lib/libattr.so</line>
				
				<line verbos="yes">mv -v /usr/lib64/libattr.so.* /lib64</line>
				<line verbos="yes">ln -sfv ../../lib/$(readlink /usr/lib/libattr.so) /usr/lib/libattr.so</line>
            </action>
		</entry>
		
		<entry name="acl-2.2.52" type="package/src" seq="15" cdto="yes" download="no" extract="yes">
		    <filename>acl-2.2.52.src.tar.gz</filename>
		    <version>2.2.52</version>
		    <checksum type="md5">a61415312426e9c2212bd7dc7929abda</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">sed -i -e 's|/@pkg_name@|&amp;-@pkg_version@|' include/builddefs.in</line>
				<line verbos="yes">sed -i "s:| sed.*::g" test/{sbits-restore,cp,misc}.test</line>
				<line verbos="yes">sed -i -e "/TABS-1;/a if (x > (TABS-1)) x = (TABS-1);" libacl/__acl_to_any_text.c</line>
				<line verbos="yes">
					./configure                \
						--prefix=/usr          \
						--disable-static       \
						--libexecdir=/usr/lib
				</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install install-dev install-lib</line>
				
				<line verbos="yes">chmod -v 755 /usr/lib/libacl.so</line>
				
				<line verbos="yes">mv -v /usr/lib64/libacl.so.* /lib64</line>
				<line verbos="yes">ln -sfv ../../lib/$(readlink /usr/lib/libacl.so) /usr/lib/libacl.so</line>
			</action>
		</entry>
		
		<entry name="libcap-2.25" type="package/src" seq="16" cdto="yes" download="no" extract="yes">
		    <filename>libcap-2.25.tar.xz</filename>
		    <version>2.25</version>
		    <checksum type="md5">6666b839e5d46c2ad33fc8aa2ceb5f77</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">sed -i '/install.*STALIBNAME/d' libcap/Makefile</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make RAISE_SETFCAP=no prefix=/usr install</line>
				<line verbos="yes">chmod -v 755 /usr/lib64/libcap.so</line>
				<line verbos="yes">mv -v /usr/lib64/libcap.so.* /lib64</line>
				<line verbos="yes">ln -sfv ../../lib/$(readlink /usr/lib/libcap.so) /usr/lib/libcap.so</line>
			</action>
		</entry>
		
		<entry name="sed-4.2.2" type="package/src" seq="17" cdto="yes" download="no" extract="yes">
		    <filename>sed-4.2.2.tar.bz2</filename>
		    <version>4.2.2</version>
		    <checksum type="md5">7ffe1c7cdc3233e1e0c4b502df253974</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">
            		./configure                               \
            			--prefix=/usr                         \
            			--bindir=/bin                         \
            			--htmldir=/usr/share/doc/sed-4.2.2
            	</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make html</line>
				<line verbos="yes">make install</line>
				<line verbos="yes">make -C doc install-html</line>
			</action>
		</entry>
		
		<entry name="shadow-4.2.1" type="package/src" seq="18" cdto="yes" download="no" extract="yes">
		    <filename>shadow-4.2.1.tar.xz</filename>
		    <version>4.2.1</version>
		    <checksum type="md5">2bfafe7d4962682d31b5eba65dba4fc8</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">sed -i 's/groups$(EXEEXT) //' src/Makefile.in</line>
				<line verbos="yes">find man -name Makefile.in -exec sed -i 's/groups\.1 / /' {} \;</line>
				<line verbos="yes">find man -name Makefile.in -exec sed -i 's/getspnam\.3 / /' {} \;</line>
				<line verbos="yes">find man -name Makefile.in -exec sed -i 's/passwd\.5 / /' {} \;</line>
				<line verbos="yes">sed -i -e 's@#ENCRYPT_METHOD DES@ENCRYPT_METHOD SHA512@' -e 's@/var/spool/mail@/var/mail@' etc/login.defs</line>
				<line verbos="yes">sed -i 's/1000/999/' etc/useradd</line>
				<line verbos="yes">./configure --sysconfdir=/etc --with-group-name-max-length=32</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
				<line verbos="yes">mv -v /usr/bin/passwd /bin</line>
			</action>
		</entry>
		
		<entry name="psmisc-22.21" type="package/src" seq="19" cdto="yes" download="no" extract="yes">
		    <filename>psmisc-22.21.tar.gz</filename>
		    <version>22.21</version>
		    <checksum type="md5">935c0fd6eb208288262b385fa656f1bf</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">./configure --prefix=/usr</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
				<line verbos="yes">mv -v /usr/bin/fuser /bin</line>
				<line verbos="yes">mv -v /usr/bin/killall /bin</line>
			</action>
		</entry>
		
		<entry name="iana-etc-2.30" type="package/src" seq="20" cdto="yes" download="no" extract="yes">
		    <filename>iana-etc-2.30.tar.bz2</filename>
		    <version>2.30</version>
		    <checksum type="md5">3ba3afb1d1b261383d247f46cb135ee8</checksum>
            <action when="after" seq="1">
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
			</action>
		</entry>
		
		<entry name="m4-1.4.17" type="package/src" seq="21" cdto="yes" download="no" extract="yes">
		    <filename>m4-1.4.17.tar.xz</filename>
		    <version>1.4.17</version>
		    <checksum type="md5">12a3c829301a4fd6586a57d3fcf196dc</checksum>
            <action when="after" seq="1">
				<line verbos="yes">./configure --prefix=/usr</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
			</action>
		</entry>
		
		<entry name="bison-3.0.4" type="package/src" seq="22" cdto="yes" download="no" extract="yes">
		    <filename>bison-3.0.4.tar.xz</filename>
		    <version>3.0.4</version>
		    <checksum type="md5">c342201de104cc9ce0a21e0ad10d4021</checksum>
            <action when="after" seq="1">
				<line verbos="yes">
					./configure                                 \
						--prefix=/usr                           \
						--docdir=/usr/share/doc/bison-3.0.4
				</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
			</action>
		</entry>
		
		<entry name="flex-2.6.1" type="package/src" seq="23" cdto="yes" download="no" extract="yes">
		    <filename>flex-2.6.1.tar.xz</filename>
		    <version>2.6.1</version>
		    <checksum type="md5">cd3c86290fc2676a641aefafeb10848a</checksum>
            <action when="after" seq="1">
				<line verbos="yes">
					./configure                              \
						--prefix=/usr                        \
						--docdir=/usr/share/doc/flex-2.6.1
				</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
				<line>ln -sv flex /usr/bin/lex</line>
			</action>
		</entry>
		
		<entry name="grep-2.25" type="package/src" seq="24" cdto="yes" download="no" extract="yes">
		    <filename>grep-2.25.tar.xz</filename>
		    <version>2.25</version>
		    <checksum type="md5">04e96b0e6f0fe6a180ae62c88fcd0af6</checksum>
            <action when="after" seq="1">
				<line verbos="yes">./configure --prefix=/usr --bindir=/bin</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
				<line></line>
			</action>
		</entry>
		
		<entry name="readline-6.3" type="package/src" seq="25" cdto="yes" download="no" extract="yes">
		    <filename>readline-6.3.tar.gz</filename>
		    <version>6.3</version>
		    <checksum type="md5">33c8fb279e981274f485fd91da77e94a</checksum>
            <action when="after" seq="1">
				<line verbos="yes">patch -Np1 -i $PROJECT__PKG/readline-6.3-upstream_fixes-3.patch</line>
				<line verbos="yes">sed -i '/MV.*old/d' Makefile.in</line>
				<line verbos="yes">sed -i '/{OLDSUFF}/c:' support/shlib-install</line>
				<line verbos="yes">
					./configure                               \
						--prefix=/usr                         \
						--disable-static                      \
						--docdir=/usr/share/doc/readline-6.3
				</line>
				<line verbos="yes">make SHLIB_LIBS=-lncurses</line>
				<line verbos="yes">make SHLIB_LIBS=-lncurses install</line>
				
				<line verbos="yes">mv -v /usr/lib64/lib{readline,history}.so.* /lib64</line>
				<line verbos="yes">ln -sfv ../../lib/$(readlink $PROJECT__RFS/usr/lib/libreadline.so) /usr/lib/libreadline.so</line>
				<line verbos="yes">ln -sfv ../../lib/$(readlink $PROJECT__RFS/usr/lib/libhistory.so ) /usr/lib/libhistory.so</line>
				
				<line verbos="yes">install -v -m644 doc/*.{ps,pdf,html,dvi} /usr/share/doc/readline-6.3</line>
			</action>
		</entry>
		
		<entry name="bash-4.3.30" type="package/src" seq="26" cdto="yes" download="no" extract="yes">
		    <filename>bash-4.3.30.tar.gz</filename>
		    <version>4.3.30</version>
		    <checksum type="md5">a27b3ee9be83bd3ba448c0ff52b28447</checksum>
            <action when="after" seq="1">
				<line verbos="yes">patch -Np1 -i $PROJECT__PKG/bash-4.3.30-upstream_fixes-3.patch</line>
				<line verbos="yes">
					./configure                              \
						--prefix=/usr                        \
						--docdir=/usr/share/doc/bash-4.3.30  \
						--without-bash-malloc                \
						--with-installed-readline
				</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
				<line verbos="yes">mv -vf /usr/bin/bash /bin</line>
				<line verbos="yes">ln -s ./bash /bin/sh</line>
			</action>
		</entry>
		
		<entry name="bc-1.06.95" type="package/src" seq="27" cdto="yes" download="no" extract="yes">
		    <filename>bc-1.06.95.tar.bz2</filename>
		    <version>1.06.95</version>
		    <checksum type="md5">5126a721b73f97d715bb72c13c889035</checksum>
            <action when="after" seq="1">
				<line verbos="yes">patch -Np1 -i $PROJECT__PKG/bc-1.06.95-memory_leak-1.patch</line>
				<line verbos="yes">
					./configure                    \
						--prefix=/usr              \
						--with-readline            \
						--mandir=/usr/share/man    \
						--infodir=/usr/share/info
				</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
			</action>
		</entry>
		
		<entry name="libtool-2.4.5" type="package/src" seq="28" cdto="yes" download="no" extract="yes">
		    <filename>libtool-2.4.6.tar.xz</filename>
		    <version>2.4.6</version>
		    <checksum type="md5">1bfb9b923f2c1339b4d2ce1807064aa5</checksum>
            <action when="after" seq="1">
				<line verbos="yes">./configure --prefix=/usr</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
			</action>
		</entry>
		
		<entry name="gdbm-1.12" type="package/src" seq="29" cdto="yes" download="no" extract="yes">
		    <filename>gdbm-1.12.tar.gz</filename>
		    <version>1.12</version>
		    <checksum type="md5">9ce96ff4c99e74295ea19040931c8fb9</checksum>
            <action when="after" seq="1">
				<line verbos="yes">
					./configure                  \
						--prefix=/usr            \
						--disable-static         \
						--enable-libgdbm-compat
				</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
			</action>
		</entry>
		
		<entry name="gperf-3.0.4" type="package/src" seq="30" cdto="yes" download="no" extract="yes">
		    <filename>gperf-3.0.4.tar.gz</filename>
		    <version>1.12</version>
		    <checksum type="md5">c1f1db32fb6598d6a93e6e88796a8632</checksum>
            <action when="after" seq="1">
				<line verbos="yes">./configure --prefix=/usr --docdir=/usr/share/doc/gperf-3.0.4</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
			</action>
		</entry>
		
		<entry name="expat-2.2.0" type="package/src" seq="31" cdto="yes" download="no" extract="yes">
		    <filename>expat-2.2.0.tar.bz2</filename>
		    <version>2.2.0</version>
		    <checksum type="md5">2f47841c829facb346eb6e3fab5212e2</checksum>
            <action when="after" seq="1">
				<line verbos="yes">./configure --prefix=/usr --disable-static</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
				
				<line verbos="yes">install -v -dm755 /usr/share/doc/expat-2.2.0</line>
				<line verbos="yes">install -v -m644 doc/*.{html,png,css} /usr/share/doc/expat-2.2.0</line>
			</action>
		</entry>
		
		<entry name="inetutils-1.9.4" type="package/src" seq="32" cdto="yes" download="no" extract="yes">
		    <filename>inetutils-1.9.4.tar.xz</filename>
		    <version>1.9.4</version>
		    <checksum type="md5">87fef1fa3f603aef11c41dcc097af75e</checksum>
            <action when="after" seq="1">
				<line verbos="yes">
					./configure                 \
						--prefix=/usr           \
						--localstatedir=/var    \
						--disable-logger        \
						--disable-whois         \
						--disable-rcp           \
						--disable-rexec         \
						--disable-rlogin        \
						--disable-rsh           \
						--disable-servers
				</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
				
				<line verbos="yes">mv -v /usr/bin/{hostname,ping,ping6,traceroute} /bin</line>
				<line verbos="yes">mv -v /usr/bin/ifconfig /sbin</line>
			</action>
		</entry>
		
		<entry name="perl-5.24.0" type="package/src" seq="33" cdto="yes" download="no" extract="yes">
		    <filename>perl-5.24.0.tar.bz2</filename>
		    <version>5.24.0</version>
		    <checksum type="md5">99f39abe614b50719d9915431e54fc1e</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">echo "127.0.0.1 localhost $(hostname)" > /etc/hosts</line>
            	<line verbos="yes">export BUILD_ZLIB=False</line>
            	<line verbos="yes">export BUILD_BZIP2=0</line>
				<line verbos="yes">
					sh Configure                        \
						-des                            \
						-Dprefix=/usr                   \
						-Dvendorprefix=/usr             \
						-Dman1dir=/usr/share/man/man1   \
						-Dman3dir=/usr/share/man/man3   \
						-Dpager="/usr/bin/less -isR"    \
						-Duseshrplib
				</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
				<line verbos="yes">unset BUILD_ZLIB BUILD_BZIP2</line>
			</action>
		</entry>
		
		<entry name="XML-Parser-2.44" type="package/src" seq="34" cdto="yes" download="no" extract="yes">
		    <filename>XML-Parser-2.44.tar.gz</filename>
		    <version>2.44</version>
		    <checksum type="md5">af4813fe3952362451201ced6fbce379</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">perl Makefile.PL</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
			</action>
		</entry>
		
		<entry name="intltool-0.51.0" type="package/src" seq="35" cdto="yes" download="no" extract="yes">
		    <filename>intltool-0.51.0.tar.gz</filename>
		    <version>0.51.0</version>
		    <checksum type="md5">12e517cac2b57a0121cda351570f1e63</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">sed -i 's:\\\${:\\\$\\{:' intltool-update.in</line>
				<line verbos="yes">./configure --prefix=/usr</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
				<line verbos="yes">install -v -Dm644 doc/I18N-HOWTO /usr/share/doc/intltool-0.51.0/I18N-HOWTO</line>
			</action>
		</entry>
		
		<entry name="autoconf-2.69" type="package/src" seq="36" cdto="yes" download="no" extract="yes">
		    <filename>autoconf-2.69.tar.xz</filename>
		    <version>2.69</version>
		    <checksum type="md5">50f97f4159805e374639a73e2636f22e</checksum>
            <action when="after" seq="1">
				<line verbos="yes">./configure --prefix=$PROJECT__RFS/usr</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
			</action>
		</entry>
		
		<entry name="automake-1.15" type="package/src" seq="37" cdto="yes" download="no" extract="yes">
		    <filename>automake-1.15.tar.xz</filename>
		    <version>1.15</version>
		    <checksum type="md5">9a1ddb0e053474d9d1105cfe39b0c48d</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">sed -i 's:/\\\${:/\\\$\\{:' bin/automake.in</line>
				<line verbos="yes">
					./configure                                 \
						--prefix=/usr                           \
						--docdir=/usr/share/doc/automake-1.15
				</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
			</action>
		</entry>
		
		<entry name="xz-5.2.2" type="package/src" seq="38" cdto="yes" download="no" extract="yes">
		    <filename>xz-5.2.2.tar.xz</filename>
		    <version>5.2.2</version>
		    <checksum type="md5">e26772b69940085c0632589ab1d52e64</checksum>
            <action when="after" seq="1">
            	<line verbos="yes">sed -e '/mf\.buffer = NULL/a next->coder->mf.size = 0;' -i src/liblzma/lz/lz_encoder.c</line>
				<line verbos="yes">
					./configure                            \
						--prefix=/usr                      \
						--disable-static                   \
						--docdir=/usr/share/doc/xz-5.2.2
				</line>
				<line verbos="yes">make</line>
				<line verbos="yes">make install</line>
				<line verbos="yes">mv -v /usr/bin/{lzma,unlzma,lzcat,xz,unxz,xzcat} /bin</line>
				<line verbos="yes">mv -v /usr/bin/{lzma,unlzma,lzcat,xz,unxz,xzcat} /bin</line>
				<line verbos="yes">mv -v /usr/lib/liblzma.so.* /lib</line>
				<line verbos="yes">ln -svf ../../lib/$(readlink /usr/lib/liblzma.so) /usr/lib/liblzma.so</line>
			</action>
		</entry>
		
	</phase>
	
	<phase seq="2" disabled="yes">
	    <entry type="script/bash" seq="1" cdto="no" download="no" extract="no">
            <action when="after" seq="1">
                <line>echo -e "\n\nCreating root filesystem...\n"</line>
                
                <line>GLIBC_INSTALLED="/glibc-2.23/glibc_installed"</line>
                
                <line>mkdir -v -p /boot</line>
                <line>mkdir -v -p /dev</line>
                <line>mkdir -v -p /etc</line>
                <line>mkdir -v -p /lib</line>
                <line>mkdir -v -p /srv</line>
                <line>mkdir -v -p /proc</line>
                <line>mkdir -v -p /root</line>
                <line>mkdir -v -p /home</line>
                <line>mkdir -v -p /sys</line>
                <line>mkdir -v -p /mnt</line>
                <line>mkdir -v -p /media</line>
                <line>mkdir -v -p /opt</line>
                <line>mkdir -v -p /tmp</line>
                
                <line>chmod 1777 /tmp</line>
                
                <line>
					cat > /etc/bootscript.sh &lt;&lt;-EOF
					#!/bin/sh
					
					dmesg -n 1
					mount -t devtmpfs none /dev
					mount -t proc none /proc
					mount -t sysfs none /sys
					
					for DEVICE in /sys/class/net/* ; do
						ip link set \${DEVICE##*/} up
						[ \${DEVICE##*/} != lo ] &amp;&amp; udhcpc -b -i \${DEVICE##*/} -s /etc/rc.dhcp
					done
					
					EOF
                </line>
                <line>chmod +x /etc/bootscript.sh</line>

                <line>
					cat > /etc/rc.dhcp &lt;&lt;-EOF
					#!/bin/sh
					
					ip addr add \$ip/\$mask dev \$interface
					
					if [ "\$router" ]; then
					    ip route add default via \$router dev \$interface
					fi
					
					EOF
                </line>
                <line>chmod +x /etc/rc.dhcp</line>

                <line>
					cat > /etc/resolv.conf &lt;&lt;-EOF
					nameserver 8.8.8.8
					nameserver 8.8.4.4
					
					EOF
                </line>
                <line>
					cat > /etc/welcome.txt &lt;&lt;-EOF
					
					
					##############################################################
					Welcome to $PROJECT__NAME-$PROJECT__VERSION ($PROJECT__ARCH)
					
					Author: 
					    $PROJECT__AUTHOR_NAME
					    $PROJECT__AUTHOR_EMAIL
					
					Website:
					    $PROJECT__WEBSITE
					##############################################################
					
					EOF
                </line>
                
                <line>
					cat > $PROJECT__RFS/etc/inittab &lt;&lt;-EOF
					::sysinit:/etc/bootscript.sh
					::restart:/sbin/init
					::ctrlaltdel:/sbin/reboot
					::once:cat /etc/welcome.txt
					::respawn:/bin/cttyhack /bin/sh
					tty2::once:cat /etc/welcome.txt
					tty2::respawn:/bin/sh
					tty3::once:cat /etc/welcome.txt
					tty3::respawn:/bin/sh
					tty4::once:cat /etc/welcome.txt
					tty4::respawn:/bin/sh
					
					EOF
				</line>
				
				<line>
					cat > $PROJECT__RFS/etc/passwd &lt;&lt;-EOF
					root:x:0:0:root:/root:/bin/sh
					bin:x:1:1:bin:/dev/null:/bin/false
					daemon:x:6:6:Daemon User:/dev/null:/bin/false
					messagebus:x:18:18:D-Bus Message Daemon User:/var/run/dbus:/bin/false
					nobody:x:99:99:Unprivileged User:/dev/null:/bin/false
					
					EOF
				</line>
				
				<line>
					cat > $PROJECT__RFS/etc/group &lt;&lt;-EOF
					root:x:0:
					bin:x:1:daemon
					sys:x:2:
					kmem:x:3:
					tape:x:4:
					tty:x:5:
					daemon:x:6:
					floppy:x:7:
					disk:x:8:
					lp:x:9:
					dialout:x:10:
					audio:x:11:
					video:x:12:
					utmp:x:13:
					usb:x:14:
					cdrom:x:15:
					adm:x:16:
					messagebus:x:18:
					systemd-journal:x:23:
					input:x:24:
					mail:x:34:
					nogroup:x:99:
					users:x:999:
					
					EOF
				</line>
				
				<line>
					cat > $PROJECT__RFS/etc/hostname &lt;&lt;-EOF
					$PROJECT__HOSTNAME
					
					EOF
				</line>
				
				<line>
					cat > $PROJECT__RFS/etc/hosts &lt;&lt;-EOF
					127.0.0.1 localhost
					127.0.0.1 $PROJECT__HOSTNAME
					
					EOF
				</line>
				
				<line>
					cat > $PROJECT__RFS/root/.bash_profile &lt;&lt;-EOF
					exec env -i HOME=/root TERM=$TERM PS1="\e[31m$(whoami)@$(hostname):$(pwd)\$ \e[39m" /bin/sh
					
					EOF
				</line>
				
				<line>
					cat > $PROJECT__RFS/root/.bashrc &lt;&lt;-EOF
					export PS1="\e[31m$(whoami)@$(hostname):$(pwd)\$ \e[39m"
					export PATH=/usr/bin:/usr/sbin:/bin:/sbin
					
					EOF
				</line>
				
                <line>
					cat > $PROJECT__RFS/init &lt;&lt;-EOF
					#!/bin/sh
					
					exec /sbin/init
					
					EOF
				</line>
				<line>chmod +x $PROJECT__RFS/init</line>
				
				<line>cd $PROJECT__RFS</line>
				<line>rm -f ./lib64</line>
				<line>ln -s ./lib ./lib64</line>
            </action>
		</entry>
	</phase>
	
	<phase seq="5" disabled="yes">
	    <entry type="script/bash" seq="1" cdto="no" download="no" extract="no">
            <action when="after" seq="1">
                <line>echo -e "\n\nPackaging root filesystem...\n"</line>
                
                <line>rm -f $PROJECT__DIR/rootfs.cpio.gz</line>
                <line>cd $PROJECT__RFS</line>
                <line>find . | cpio -R root:root -H newc -o | gzip > $PROJECT__DIR/rootfs.cpio.gz</line>
            </action>
            
            <action when="after" seq="2">
				<line>echo -e "\n\nMaking bootable iso file...\n"</line>
				
				<line>rm -rf $PROJECT__DIR/isoimage</line>
				<line>mkdir -v $PROJECT__DIR/isoimage</line>
				<line>cd $PROJECT__DIR/isoimage</line>
				<line>
					for i in lib lib64 share end ; do
						if [ -f /usr/$i/syslinux/isolinux.bin ]; then
							cp /usr/$i/syslinux/isolinux.bin .
							if [ -f /usr/$i/syslinux/ldlinux.c32 ]; then
								cp /usr/$i/syslinux/ldlinux.c32 .
							fi;
							break;
						fi;
						if [ $i = end ]; then exit 1; fi;
					done
				</line>
				<line>cp $PROJECT__BLD/linux-4.4.6/arch/$PROJECT__ARCH/boot/bzImage ./kernel.bz</line>
				<line>mv $PROJECT__DIR/rootfs.cpio.gz ./rootfs.gz</line>
				<line>echo 'default kernel.bz initrd=rootfs.gz' > ./isolinux.cfg</line>
				<line>genisoimage -J -r -o $PROJECT__DIR/isoimage/$PROJECT__ISONAME -b isolinux.bin -c boot.cat -no-emul-boot -boot-load-size 4 -boot-info-table ./</line>
				<line>isohybrid $PROJECT__DIR/isoimage/$PROJECT__ISONAME 2>/dev/null || true</line>
				
				<line>echo -e "\n\n$PROJECT__NAME-$PROJECT__VERSION iso file is created\n$PROJECT__DIR/isoimage/$PROJECT__ISONAME\n"</line>
            </action>
       	</entry>
	</phase>
	
</build>

